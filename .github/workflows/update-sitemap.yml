name: Update Sitemap

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

# ğŸ”¥ å…³é”®ä¿®æ”¹ 1: å¿…é¡»ç»™ Actions å†™æƒé™ï¼Œå¦åˆ™ git push ä¼šæŠ¥é”™ 403
permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4 # å»ºè®®ç”¨ v4
        with:
          ref: 'master' # ğŸ”¥ å…³é”®ä¿®æ”¹ 2: æ˜¾å¼æŒ‡å®šæ‹‰å– master åˆ†æ”¯ (å¦‚æœæ˜¯ main è¯·æ”¹æˆ main)

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22' # æ¨èç”¨ LTS ç‰ˆæœ¬ï¼Œ24 å¯èƒ½è¿˜å¤ªæ–°ä¸ç¨³å®š

      - name: Generate Sitemap
        run: node scripts/generate-sitemap.js

      - name: Commit and Push
        run: |
          git config --global user.name 'Sitemap Bot'
          git config --global user.email 'bot@noreply.github.com'
          
          git add public/sitemap.xml
          
          # ğŸ”¥ å…³é”®ä¿®æ”¹ 3: æ›´ç¨³å¥çš„æ£€æµ‹å’Œæ¨é€æ–¹å¼
          # åªæœ‰å½“æ–‡ä»¶çœŸçš„æœ‰å˜åŒ–æ—¶æ‰ commitï¼Œå¦åˆ™ä¼šæŠ¥é”™
          if [[ -n $(git status -s) ]]; then
            echo "Changes detected, committing..."
            git commit -m "chore(seo): auto update sitemap"
            
            # å¼ºåˆ¶æ¨é€åˆ°è¿œç¨‹çš„ master åˆ†æ”¯
            git push origin HEAD:master
          else
            echo "No changes in sitemap, skipping push."
          fi